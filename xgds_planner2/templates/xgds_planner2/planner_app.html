{% extends "base.html" %}
{% load pipeline %}

{% block sitemenu-content-secondary %}
{% include "xgds_planner2/planner2_subnav.html" %}
{% endblock %}

{% block siteSection %}Edit {{ plan_name }}{% endblock %}
{% block content %}

{% block cssExtras %}
	<!-- <link rel="stylesheet" href="{{ STATIC_URL }}external/css/backbone.forms.default.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}external/css/kmltree.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}external/css/jquery/jquery-ui.css">
    <link rel="stylesheet" href="{{ STATIC_URL }}xgds_planner2/css/planner.css"> -->
{% endblock cssExtras %}

<style scoped>
  {% stylesheet 'planner_app' %}
</style>

<div id="application" >
    <div id="toolbar" class="row">
    </div>

    <div class="row">
        <div id="map" class="five columns"></div>
        <div id="tabs" class="seven columns"></div>
    </div>
    
    <div id="saveAsDialog" style="display:none">
		<p>Enter a new name and/or version to save as.  (Version already changed.)</p>
		<table>
		<tr>
			<td>Name</td>
			<td><input type="text" id="saveAsName"></td>
		</tr>
		<tr>
			<td>Version</td>
			<td><input type="text" id="saveAsVersion"></td>
		</tr>
		<tr>
			<td>Notes</td>
			<td><input type="text" id="saveAsNotes"></td>
		</tr>
		<tr></tr>
		</table>
	</div>
    
</div>
{% endblock content %}


{% block scripts %}
    {% if not settings.XGDS_PLANNER_OFFLINE %}
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    {% endif %}
    {# javascript 'planner_app' #}
    <!-- <script type="text/javascript" src='{{STATIC_URL}}external/js/underscore-min.js'></script> -->
    <script type="text/javascript" src='{{STATIC_URL}}external/js/jquery/jquery-2.1.3.min.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}external/js/jquery/jquery.migrate.min.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}external/js/jquery/jquery-ui.min.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}external/js/lodash.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}external/js/handlebars.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}external/js/backbone.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}external/js/backbone.wreqr.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}external/js/backbone.babysitter.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}external/js/backbone-relational.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}external/js/backbone-forms.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}external/js/backbone.marionette.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}external/js/string-format.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}external/js/kmltree.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}external/js/usng.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}external/js/proj4-2.2.1.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}xgds_planner2/js/handlebars-helpers.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}xgds_planner2/js/geo.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}xgds_planner2/js/forms.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}xgds_planner2/js/app.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}xgds_planner2/js/models.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}xgds_planner2/js/views.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}xgds_planner2/js/mapviews.js'></script>
    <script type="text/javascript" src='{{STATIC_URL}}xgds_planner2/js/simulatorDriver.js'></script>
    {% javascript 'simulator' %}
    <script type="text/javascript" src="{{STATIC_URL}}external/js/extensions-0.2.1.js"></script>
    <!-- 
    <script type="text/javascript" src="{{ planner_appUrl }}"></script>
    <script type="text/javascript" src="{{ simulatorUrl}}"></script>
    -->
    {% for template_name, template in templates.items %}
<script type="text/handlebars" id="template-{{template_name}}">
{{template|safe}}
</script>
    {% endfor %}
    <script id="plan_schema_json" type="application/json">{{ plan_schema_json|safe }}</script>
    <script id="plan_library_json" type="application/json">{{ plan_library_json|safe }}</script>
    <script id="plan_index_json" type="application/json">{{ plan_index_json|safe }}</script>
    <script id="plan_links_json" type="application/json">{{ plan_links_json|safe }}</script>
    {% if plan_json %}<script id="plan_json" type="application/json">{{ plan_json|safe }}</script>{% endif %}
{% endblock scripts %}

{% block jsInit %}
    plannerAppOptions = {
        offline: {{ settings.XGDS_PLANNER_OFFLINE|yesno:"true,false" }},
        planLineWidthPixels: {{ settings.XGDS_PLANNER_LINE_WIDTH_PIXELS|default:"2" }},
        layerFeedUrl: "{{ settings.XGDS_PLANNER_LAYER_FEED_URL }}",
        dataUrl: "{{ settings.DATA_URL }}",
        simulator: {{ simulator }},
        directionalStations: {{ settings.XGDS_PLANNER_DIRECTIONAL_STATIONS|yesno:"true,false" }},
        mapRotationHandles: {{ settings.XGDS_PLANNER_MAP_ROTATION_HANDLES|yesno:"true,false" }},
        placemarkCircleUrl: "{{ placemark_circle_url }}",
        placemarkCircleHighlightedUrl: "{{ placemark_circle_highlighted_url }}",
        placemarkDirectionalUrl: "{{ placemark_directional_url }}",
        placemarkSelectedDirectionalUrl: "{{ placemark_selected_directional_url }}",
        XGDS_PLANNER_EARTH_LOADED_CALLBACK: {{ settings.XGDS_PLANNER_EARTH_LOADED_CALLBACK }},
        commandRenderers: {{ settings.XGDS_PLANNER_COMMAND_RENDERERS|safe }},
        readOnly: {{ editable|yesno:"false,true" }}
    };
$(function(){
    app.start(plannerAppOptions);
})
{% endblock jsInit %}
