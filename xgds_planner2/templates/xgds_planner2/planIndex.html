{% extends "base.html" %}

{% load url from future %}
{% load tz_convert %}

{% block cssExtras %}
{{ block.super }}
<style type="text/css" title="currentStyle">
	@import "{{ STATIC_URL }}external/css/jquery/demo_page.css";
	@import "{{ STATIC_URL }}external/css/jquery/demo_table.css";
	@import "{{ STATIC_URL }}external/css/jquery/jquery-ui.css";
</style>
<style type="text/css">
table.planIndex td.exportFormat a {
    padding-right: 10px;
}

</style>
{% endblock cssExtras %}

{% block siteSection %}Planner Index{% endblock siteSection %}

{% block sitemenu-content-secondary %}
{% include "xgds_planner2/planner2_subnav.html" %}
{% endblock %}

{% block content %}
{{ block.super }}

<!-- This functionality is now in the subnav 
<a href="{% url 'planner2_planCreate' %}" class="mybutton">Create Plan</a>
-->

<table id="dataTable" class="planIndex">
<thead class="table_header">
  <tr>
    <th>Name</th>
    <th>Author</th>
    <th>Last Edit</th>
    <th>Site</th>
    <th>Dist</th>
    <th>#Stn</th>
    <th>#Commands</th>
    <th>Export</th>
  </tr>
</thead>
<tbody>
{% for plan in plans %}
  <tr id={{ plan.id }}>
    <td ><a href="{% url 'planner2_edit' plan.id %}">{{ plan.name }}</a></td>
    <td>{{ plan.creator }}</td>
    <td>{{ plan.dateModified|utc_to_django|date:"Y-m-d H:i" }}</td>
    <td>{{ plan.jsonPlan.site.name }}</td>
    <td class="right">{{ plan.lengthMeters|floatformat }}</td>
    <td class="center">{{ plan.numStations }}</td>
    <td >{{ plan.numCommands }} &nbsp;&nbsp;{{ plan.getSummaryOfCommandsByType|safe }}</td>
    <td class="exportFormat">
      {% for exporter in plan.getExporters %}
        <a href="{{ exporter.url }}">
          {{ exporter.label }} 
        </a>
      {% endfor %}
    </td>
  </tr>
{% endfor %}
</tbody>
</table>

{% endblock content %}

{% block scripts %}
  {{ block.super }}
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}external/js/jquery/jquery-ui.js"></script>
<script language="javascript" type="text/javascript" src="{{ STATIC_URL }}external/js/jquery/jquery.dataTables.js"></script>
<script type="text/javascript">
 var calcDataTableHeight = function() {
	    var h = Math.floor($(window).height()*65/100);
	    return h + 'px';
	};

	var defaultOptions = {
			bAutoWidth: true,
			bPaginate: true,
	        iDisplayLength: 20, 
	        bLengthChange: true,
			bSort: true,
	        bJQueryUI: true,
	        sScrollY:  calcDataTableHeight(), /* '28em', */
	        "lengthMenu": [[10, 20, 40, -1], [10, 20, 40, "All"]],
	        "oLanguage": {
	            "sLengthMenu": "Display _MENU_ plans"
	          },
	        aoColumnDefs:[
	            {
	                aTargets: ['name'],
	                sWidth: '285px',
	            },
	            {
	                aTargets: ['Export'],
	                bSortable: false,
	            },
	        ]
	}

	 $(document).ready( function () {
		var pTable = $('#dataTable').dataTable( defaultOptions);
		$(window).resize(function(){ 
			$('div.dataTables_scrollBody').css('height',calcDataTableHeight());
			pTable.fnAdjustColumnSizing();
		});

	} );
 </script>
{% endblock scripts %}
